        <!DOCTYPE html>
        <html lang="en">
        <head><title>What chroot() is really for [LWN.net]</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="robots" CONTENT="noai, noimageai">
        <link rel="icon" href="https://static.lwn.net/images/favicon.png"
              type="image/png">
        <link rel="alternate" type="application/rss+xml" title="LWN.net headlines" href="https://lwn.net/headlines/rss">
<link rel="alternate" type="application/rss+xml" title="Comments posted to this article" href="https://lwn.net/headlines/252794/">
        <link rel="stylesheet" href="/CSS/lwn">
<link rel="stylesheet" href="/CSS/nosub">

        
<script type="text/javascript">var p="http",d="static";if(document.location.protocol=="https:"){p+="s";d="engine";}var z=document.createElement("script");z.type="text/javascript";z.async=true;z.src=p+"://"+d+".adzerk.net/ados.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(z,s);</script>
<script type="text/javascript">
var ados_keywords = ados_keywords || [];
if( location.protocol=='https:' ) {
        ados_keywords.push('T:SSL');
} else {
        ados_keywords.push('T:HTTP');
}

var ados = ados || {};
ados.run = ados.run || [];
ados.run.push(function() {

ados_add_placement(4669, 20979, "azk13321_leaderboard", 4).setZone(16026);

ados_add_placement(4669, 20979, "azk93271_right_zone", [5,10,6]).setZone(16027);

ados_add_placement(4669, 20979, "azk31017_tracking", 20).setZone(20995);



ados_setKeywords(ados_keywords.join(', ')); 
ados_load();
});</script>

        </head>
        <body>
        <a name="t"></a>
<div id="menu"><a href="/"><img src="https://static.lwn.net/images/logo/barepenguin-70.png" class="logo"
                 border="0" alt="LWN.net Logo">
           <span class="logo">LWN<br>.net</span>
           <span class="logobl">News from the source</span></a>
           <a href="/"><img src="https://static.lwn.net/images/lcorner-ss.png" class="sslogo"
                 border="0" alt="LWN"></a><div class="navmenu-container">
           <ul class="navmenu">
        <li><a class="navmenu" href="#t"><b>Content</b></a><ul><li><a href="/current/">Weekly Edition</a></li><li><a href="/Archives/">Archives</a></li><li><a href="/Search/">Search</a></li><li><a href="/Kernel/">Kernel</a></li><li><a href="/Security/">Security</a></li><li><a href="/Calendar/">Events calendar</a></li><li><a href="/Comments/unread">Unread comments</a></li><li><hr></li><li><a href="/op/FAQ.lwn">LWN FAQ</a></li><li><a href="/op/AuthorGuide.lwn">Write for us</a></li></ul></li>
<li><a class="navmenu" href="#t"><b>Edition</b></a><ul><li><a href="/Articles/251783/">Return to the Security page</a></li></ul></li>
</ul></div>
</div> <!-- menu -->
<div class="not-handset"
            	     style="margin-left: 10.5em; display: block;">
                   <div class="not-print"> <div id="azk13321_leaderboard"></div> </div>
                </div>
            <div class="topnav-container">
<div class="not-handset"><form action="https://lwn.net/Login/" method="post" name="loginform"
                 class="loginform">
        <label><b>User:</b> <input type="text" name="uname" value="" size="8" id="uc" /></label> 
		<label><b>Password:</b> <input type="password" name="pword" size="8" id="pc" /></label> <input type="hidden" name="target" value="/Articles/252794/" /> <input type="submit" name="submit" value="Log in" /></form> |
           <form action="https://lwn.net/subscribe/" method="post" class="loginform">
           <input type="submit" name="submit" value="Subscribe" />
           </form> |
           <form action="https://lwn.net/Login/newaccount" method="post" class="loginform">
           <input type="submit" name="submit" value="Register" />
           </form>
        </div>
               <div class="handset-only">
               <a href="/subscribe/"><b>Subscribe</b></a> /
               <a href="/Login/"><b>Log in</b></a> /
               <a href="/Login/newaccount"><b>New account</b></a>
               </div>
               </div><div class="maincolumn flexcol">
<div class="middlecolumn">
<div class="PageHeadline">
<h1>What chroot() is really for</h1>
</div>
<div class="ArticleText">
<div class="FeatureByline">
           By <b>Jake Edge</b><br>October 3, 2007
           </div>
<p>The <tt>chroot()</tt> system call 
is often misunderstood, as it can appear to do much more than it
actually does.  The confusion arises because it appears to some to be a
security tool &ndash; there are limited security uses &ndash; when it is
meant as a tool for isolating processes for installation, debugging, and
legacy library usage.
</p>

<p> What <tt>chroot()</tt> actually does is fairly simple, it modifies
pathname lookups for a process and its children so that any reference to a
path starting '/' will effectively have the new root, which is passed as
the single argument, prepended onto the path.  The current working
directory is left unchanged and relative paths can still refer to files
outside of the new root.

<p>
Calls to <tt>chroot()</tt>
do not stack, with additional calls essentially overwriting the existing
one.  It can only be called by privileged programs and can be trivially
bypassed by those who can call it as <tt>man 2 chroot</tt> describes:

<pre>
    This  call does not change the current working directory, so that after
    the call '.' can be outside the tree rooted at '/'.  In particular, the
    superuser  can  escape from a 'chroot jail' by doing 'mkdir foo; chroot
    foo; cd ..'.
</pre>

<p>
The use of the term "chroot jail" in the manpage is unfortunate as it may
help perpetuate a common misconception about <tt>chroot()</tt>.  It often
gets mentioned in the same context as the "jail" calls
for the BSDs, but it has little in common with them.  A BSD jail is a
mini-virtualization that partitions a system into multiple virtual systems
each of which can have its own root account.  <tt>chroot()</tt> has none of
that sophistication.

<p> A <a href="/Articles/252806/">patch</a> posted to the linux-kernel
mailing list was aimed at fixing the "hole" described in the manpage, but
led, instead, to a rather contentious thread.  The patch changes
<tt>chroot()</tt> by setting the current working directory to the new root
if it was not already somewhere underneath it.  This violates POSIX and
other standards, which specify the current behavior, as well as numerous
typical use cases for <tt>chroot()</tt>.  In addition, as was forcefully
pointed out in the thread, there are innumerable ways for a privileged
process to access files that are not underneath the new root.  Even if it
did not run afoul of the standards, there is no point in fixing something
that is so trivially bypassed in other ways.  </p>

<p>
The proponents of fixing the problem that they see &ndash; even if most of
the kernel hackers disagree &ndash; seem to
believe that, while you can circumvent a <tt>chroot()</tt> call, it should
not be possible by using <tt>chroot()</tt> itself.  It is an argument that
didn't seem to get anywhere for a pretty simple reason: <tt>chroot()</tt>
is not meant to be a security-oriented access control mechanism.  It is,
instead, a way to run processes with a partitioned view of the filesystem.
</p>

<p> There are reasonable uses of <tt>chroot()</tt> for very limited
security purposes.  Daemons that do not run as root can be placed into
their own filesystem subtree &ndash; bind/named and Apache are sometimes
run this way &ndash; to prevent any access outside of it.  That will work,
even if the daemon gets exploited, as long as there is no way to elevate
privileges after the exploit.  For example, if there are vulnerable
<tt>setuid()</tt> programs accessible from within the <tt>chroot()</tt>,
full filesystem access is possible.  </p>

<p> <tt>chroot()</tt> is a useful call, many install programs use it, as do
programs that need to see a consistent set of older libraries, but it has
very limited use in security applications.  It does <i>not</i> provide a
sandbox that can be used to test suspicious code, that code might escalate
its privilege and access anything it wished.  Maintaining an up-to-date
<tt>chroot()</tt> environment adds an additional burden on administrators
as well; update tools do nothing to help keep utilities secure if they live
outside of the normal places.  It is probably safest to avoid using it as
any kind of security tool.  </p><br clear="all"><table class="IndexEntries">
           <tr><th colspan=2>Index entries for this article</th></tr>
           <tr><td><a href="/Security/Index/">Security</a></td><td><a href="/Security/Index/#chroot">chroot()</a></td></tr>
            <tr><td><a href="/Security/Index/">Security</a></td><td><a href="/Security/Index/#Jails">Jails</a></td></tr>
            </table><br clear="all">
<hr width="60%%" align="left">
            <form action="/Login/" method="post">
            <input type="hidden" name="target" value="/Articles/252794/" />
            <input type="submit" name="login" value="Log in" /> to post comments
            <p>
        
</div> <!-- ArticleText -->
<p><a name="Comments"></a>
<a name="CommAnchor253007"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2007 4:29 UTC (Thu)
                               by <b>sweikart</b> (guest, #4276)
                              [<a href="/Articles/253007/">Link</a>] 
      </p>
      
      </div>
      </summary>
      A good overview of using chroot for security can be found at:<br>
<p>
  <a href="http://kerneltrap.org/Linux/Abusing_chroot#comment-273655">http://kerneltrap.org/Linux/Abusing_chroot#comment-273655</a><br>
<p>
<font class="QuotedText">&gt; Maintaining an up-to-date chroot() environment adds an additional</font><br>
<font class="QuotedText">&gt; burden on administrators as well; update tools do nothing to help</font><br>
<font class="QuotedText">&gt; keep utilities secure if they live outside of the normal places.</font><br>
<p>
Various people have written scripts that will create chroot jails;<br>
I'm not sure sure how many of them will also update chroot jails.<br>
<p>
When you write a chroot-jail builder-script, it's not that hard to<br>
write it to either create a new jail or update an existing jail<br>
(I've written my scripts that way).<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253007/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor253062"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2007 10:29 UTC (Thu)
                               by <b>pointwood</b> (guest, #2814)
                              [<a href="/Articles/253062/">Link</a>] (12 responses)
      </p>
      
      </div>
      </summary>
      What is the recommended tool/way/option to use instead?<br>
<p>
Of course, there is VmWare, etc., but it would be nice to have something like this for a ftp/sftp server, etc.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253062/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor253071"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2007 11:18 UTC (Thu)
                               by <b>petebull</b> (guest, #7857)
                              [<a href="/Articles/253071/">Link</a>] (8 responses)
      </p>
      
      </div>
      </summary>
      Learn and use SELinux. The <a 
href="http://en.wikipedia.org/wiki/SELinux">wikipedia article</a> has 
apparently a reasonable number of links for further information, apart 
from what is available in the entry itself. 
      
          <div class="CommentReplyButton">
            <form action="/Articles/253071/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor253202"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2007 19:17 UTC (Thu)
                               by <b>sbergman27</b> (guest, #10767)
                              [<a href="/Articles/253202/">Link</a>] (7 responses)
      </p>
      
      </div>
      </summary>
      The problem I see with SELinux is complexity.  The two rules I try to apply to both security and backups are:<br>
<p>
1. Keep it simple.<br>
2. Keep it clear.<br>
<p>
SELinux, as powerful and useful as it can be when it is really needed, fails both of those tests for most applications.<br>
<p>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253202/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor253260"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2007 23:07 UTC (Thu)
                               by <b>smoogen</b> (subscriber, #97)
                              [<a href="/Articles/253260/">Link</a>] (6 responses)
      </p>
      
      </div>
      </summary>
      While this may not be the case in your post.. I see this argument used over and over again by people who have NEVER looked at SeLinux or tried to use it. They heard it somewhere else, or found a FAQ that said turn it off etc.. but never actually looked at it in any form.<br>
<p>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253260/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor253289"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 5, 2007 4:04 UTC (Fri)
                               by <b>wahern</b> (subscriber, #37304)
                              [<a href="/Articles/253289/">Link</a>] (5 responses)
      </p>
      
      </div>
      </summary>
      Why should they look at SELinux at all? The "least cost avoider" regarding software robustness is the developer, not the user. In other words, why do a million administrators have to lock down applications when the developer could have written the application better to begin with. Why are people arguing for solutions that put the onus on the user, AT THE EXPENSE of solutions which the developer can implement? I don't mean to say that SELinux shouldn't be used, but with limited time and resources, it seems to make sense to me to emphasize the measures developers can take.<br>
<p>
Also, if SELinux were actually easy to use, why don't Linux distributions ship with policies that don't frustrate users? That's not to say it can't be done. It's only evidence that it can't be done well, yet. In my opinion, there's some key abstraction missing which, when discovered, will likely make MAC schemes more intuitive, automagically adaptable to the environment, and much more common place than they are. We just aren't there yet. The evolution of Unix tells us that only those interfaces which have proven themselves become standardized across platforms. For my money, compartmentalized environments a la BSD jails/Solaris Zones seem to be the wave of the future, even if personally I'd like to see MAC schemes become the norm.<br>
<p>
Lost in this whole debate is something called portability. As a developer, I'm not going to write software with the expectation that the user will run it in UML or a BSD jail. Fact is, chroot is available on every single Unix system, with identical semantics. I'll write my software as best I can so that diligent users can run software in a jail, but just because others can or would isn't reason to persuade me not to use chroot.<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253289/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor253325"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 5, 2007 12:38 UTC (Fri)
                               by <b>addw</b> (guest, #1771)
                              [<a href="/Articles/253325/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote><i>why do a million administrators have to lock down applications when the developer could have written the application better to begin with.</i></blockquote><p>
Because security is best done in depth; ie multiple layers so that if one fails you hopefully prevent problems by another layer.<p>
I am not saying that applications should not be well coded, but we need to be realistic and realise that all programs have bugs.
      
          <div class="CommentReplyButton">
            <form action="/Articles/253325/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor253365"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 5, 2007 15:46 UTC (Fri)
                               by <b>jond</b> (subscriber, #37669)
                              [<a href="/Articles/253365/">Link</a>] (3 responses)
      </p>
      
      </div>
      </summary>
      Because years and years and years of advisories have demonstrated to the sysadmin that this doesn't work.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253365/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor253431"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 5, 2007 20:29 UTC (Fri)
                               by <b>wahern</b> (subscriber, #37304)
                              [<a href="/Articles/253431/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      That chroot doesn't work? I can also point you to many advisories that have shown that chroot also contained an exploit. OpenSSH, BIND, Apache (OpenBSD), OpenNTP, djbdns, and qmail all use chroot, and the use of chroot has mitigated the impact of serious and widespread code exploits.<br>
<p>
chroot is not _the_ answer. In all this debate, either here or on LKML, I have yet to see anybody mistakingly suggest that chroot _alone_ is a sufficient measure. All of these straw men arguments that say that chroot shouldn't be used because chroot _alone_ isn't sufficient are fallacious.<br>
<p>
I'm only sticking to my guns because these forums are archived, and I don't want to see a student or junior engineer come to me in 10 years and say they didn't use chroot, though they trivially could have, because they were told it was useless.<br>
<p>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253431/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor253456"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 6, 2007 1:40 UTC (Sat)
                               by <b>wahern</b> (subscriber, #37304)
                              [<a href="/Articles/253456/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Oops. By "contained an exploit" I meant that an exploit was limited or curtailed, not that the chroot use itself was related to an exploit.<br>
(Though, like any interface, chroot could feasibly be part of an attack vector. As described in this thread, use of chroot is questionable when an administrator has to duplicate sensitive files for a chroot'd environment.)<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253456/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor253921"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 11, 2007 7:12 UTC (Thu)
                               by <b>gat3way</b> (guest, #47864)
                              [<a href="/Articles/253921/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Nope, chroot() works and this is its expected behavior.<br>
<p>
And BTW there are quite a lot of ways to escape it as long as you're already a root. You can for example mount filesystems on some occasions. <br>
<p>
Who said chroot() must provide security...against someone that already has root privilleges on that system???<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253921/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
</details>
</details>
</details>
</details>
<a name="CommAnchor253132"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2007 15:09 UTC (Thu)
                               by <b>ebiederm</b> (subscriber, #35028)
                              [<a href="/Articles/253132/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Look at the mount namespace in the kernel.<br>
<p>
That can give the same effect as chroot but without being able to escape.<br>
<p>
For even more strength one of the linux security modules like AppArmor or <br>
Selinux can help.<br>
<p>
For more support making an application look like it has the box to itself<br>
the ongoing work on namespaces can help.  Ultimately though while the <br>
namespaces can help improve security just like chroot that isn't their <br>
primary point.<br>
<p>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253132/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor253255"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2007 22:18 UTC (Thu)
                               by <b>dowdle</b> (subscriber, #659)
                              [<a href="/Articles/253255/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      The article mentions FreeBSD jails and how their chroot jail is a mini-virtualization.<br>
<p>
For Linux there is OpenVZ and/or Linux-VServer... as well as the container features that have already made it into the mainline Linux kernel... and additional code that is expected to make it into the mainline kernel in the next year or so.<br>
<p>
Anyway, if you want a quality isolation (and OS Virtualization as well), you can do so with OpenVZ and/or Linux-VServer.  Of course both of those require a modified kernel... but they do work well, are mature, and offer additional features like resource management, separate root user and accounts, and in the case of OpenVZ, checkpointing (offline and online/live migration).<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253255/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor253288"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 5, 2007 3:34 UTC (Fri)
                               by <b>jordanb</b> (guest, #45668)
                              [<a href="/Articles/253288/">Link</a>] 
      </p>
      
      </div>
      </summary>
      UML has been in the kernel for a long time and works great. <br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253288/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor253162"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2007 17:12 UTC (Thu)
                               by <b>wahern</b> (subscriber, #37304)
                              [<a href="/Articles/253162/">Link</a>] (10 responses)
      </p>
      
      </div>
      </summary>
      The advice to not use chroot() for "security" is just plain wrong. "Security" involves innumerable facets of programming. To say that because something doesn't address all of them simultaneously, and thus shouldn't be used at all, is... I can't even begin to describe how wrong that advice is. The proper way to use chroot() in a security-conscious application is:<br>
<p>
chroot()<br>
chdir()<br>
setuid()<br>
<p>
How simple is that? Is it fool-proof? Of course not. Neither is a program which fixes all of its out-of-bound memory accesses perfectly secure. But that doesn't mean one should counsel people not to fix the bugs.<br>
<p>
One of the best rules of thumb in writing secure software is minimization: minimize the resources used; minimize the resources available; minimize privilege; minimize, minimize, minimize. chroot() fits perfectly into that paradigm.<br>
<p>
When people starting thinking that its better to run a daemon inside VMWare because somebody suggests chroot() is useless shows just how misleading that advice was (and running VMWare isn't exactly minimization, either, when you consider you're adding millions of lines of code to your software stack). Just because unplugging your computer from the network is "more secure" than having an internet connection doesn't mean its either practical or even advisable. chroot() is practical and useful for enhancing the security profile of a Unix application, period.<br>
<p>
That novice and ignorant programmers fall short of proper and sufficient use is neither a new phenomenon, nor reason alone to give such misleading advice.<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253162/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor253234"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2007 21:09 UTC (Thu)
                               by <b>ckelso</b> (guest, #43128)
                              [<a href="/Articles/253234/">Link</a>] (9 responses)
      </p>
      
      </div>
      </summary>
      The only valid argument for using chroot is that you are ignorant or distrusting of your filesystem, user and group permissions.  chroot isn't adding anything to the security of the daemon.  Having a daemon running with a low access system account, what is the difference between having it in a chroot and not having it there?  That's simple, access to things on the system that aren't known secure.  It doesn't enhance your applications security at all.  It mitigates your administrative incompetence.<br>
<p>
I don't disagree with the rule of least access.  I just don't agree that chroot is enhancing the security of the daemon.  If the daemon itself is insecure, you should simply not have it on your system, chroot or not.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253234/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor253244"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 4, 2007 21:46 UTC (Thu)
                               by <b>wahern</b> (subscriber, #37304)
                              [<a href="/Articles/253244/">Link</a>] 
      </p>
      
      </div>
      </summary>
      That's not a valid argument at all. Why? Because the PROGRAMMER makes the decision to use chroot, not the rest of the world. The real argument is, do you trust the diligence of the many thousands or MILLIONS of ADMINISTRATORS as a whole, not just the best ones; and do you believe yourself to be a perfect engineer incapable of making mistakes in your own code, or code you link against?<br>
<p>
If you have reason to believe people might not keep the safest systems (like, maybe they just don't have the time to modify all the stupid SUID applications on a modern Linux installation), and if you are the least bit humble, then chroot()+chdir()+setuid()--if it fits the design and purpose of the application--is a valuable tool.<br>
<p>
Security is a process, not a thing. No daemon in existence is provably secure (well; that's not technically true, because you can convert any piece of software to a mathematical function and make proofs, but I digress). You make small decisions when writing software which, in the aggregate, improve the robustness of the application substantively.<br>
<p>
The problem is that people believe that using chroot is a hack. Its not a hack. By that measure, not running daemons as root is just as much a hack, because if its "insecure, you should simply not have it on your system".  Using chroot is, on its own merits, a useful interface to marginally increase the robustness of your application. That's as much as you can say about anything when writing software, and its all the reason you need to use it. Plain and simple.<br>
<p>
Also, this notion that you need to maintain a whole separate file system for chroot'd applications is nonsense. I've written dozens of daemons which can chroot into empty directories. Sure chroot'd Apache is a PITA if you're using Perl modules. In those cases clearly chroot conflicts with the functionality of the application. There are lots of these cases where file system resources, and process permissions create headaches. Many people--and companies--stubbornly run applications as root because its more convenient. Cases of idiots and cases where doing something is justifiable are not arguments for throwing away a technique completely.<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253244/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor253320"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 5, 2007 11:56 UTC (Fri)
                               by <b>Klavs</b> (guest, #10563)
                              [<a href="/Articles/253320/">Link</a>] (4 responses)
      </p>
      
      </div>
      </summary>
      Chroot definetely has it's uses in the security field.<br>
<p>
The apache example is a good one. One should always have several layers of security, and putting apache in a chroot is such a layer - and a good one at that. The "risk" of someone finding a bug in some website software is VERY high - even if it's your own software and you've been security conscious - we all make mistakes, and also new bugs is found in PHP and other languages all the time.<br>
<p>
Also - it is a VERY good idea to mount /tmp none-executable (if in a chroot - there's a limit to what the executable can do though :) and to have a seperate DB-user for the user (ie. what the casual browser/internet user sees) and the admin section, and remember the principle of least privilege.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253320/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor253366"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 5, 2007 15:47 UTC (Fri)
                               by <b>jond</b> (subscriber, #37669)
                              [<a href="/Articles/253366/">Link</a>] (2 responses)
      </p>
      
      </div>
      </summary>
      Non-executable /tmp can be trivially circumvented by calling the loader with your binary as an argument.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253366/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor253443"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 5, 2007 22:04 UTC (Fri)
                               by <b>giraffedata</b> (guest, #1954)
                              [<a href="/Articles/253443/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <blockquote>
Non-executable /tmp can be trivially circumvented by calling the loader with your binary as an argument.
</blockquote>
<p>
Then you'd probably want to make sure that loader isn't present in your chroot jail.  I assume you're talking about glibc's ld-linux.so, which is an essential part of running programs that use dynamically linked libraries.  Chroot jails I've seen have statically linked programs and don't need it.
<p>
Incidentally, if this is really an issue -- people want to have shared libraries within a chroot jail and still stop people from running programs they created themselves in /tmp -- it would not be hard to disable ld-linux.so's ability to run programs like that.  The ability to exec ld-linux.so is a frill added to its basic function as a Linux program interpreter that runs when you exec something else.

      
          <div class="CommentReplyButton">
            <form action="/Articles/253443/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor253926"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 11, 2007 8:48 UTC (Thu)
                               by <b>tbleher</b> (guest, #48307)
                              [<a href="/Articles/253926/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt; Non-executable /tmp can be trivially circumvented by calling the loader</font><br>
<font class="QuotedText">&gt; with your binary as an argument.</font><br>
<p>
That was true some years ago. Nowadays ld-linux.so fails if it is called <br>
on a binary on a non-executable mount.<br>
<p>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253926/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor253539"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 7, 2007 17:56 UTC (Sun)
                               by <b>thedevil</b> (guest, #32913)
                              [<a href="/Articles/253539/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <font class="QuotedText">&gt;&gt; The apache example is a good one. One should always have several layers of security, and putting apache in a chroot is such a layer - and a good one at that. The "risk" of someone finding a bug in some website software is VERY high - even if it's your own software and you've been security conscious - we all make mistakes, and also new bugs is found in PHP and other languages all the time. &lt;&lt;</font><br>
<p>
How do you enable per-user web directories (typically ~/public_html) if the webserver is chrooted?<br>
<p>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253539/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor253513"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 6, 2007 23:22 UTC (Sat)
                               by <b>acorliss</b> (guest, #3710)
                              [<a href="/Articles/253513/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      No offense, but that's idiotic.  There's many files on a system that are by design world readable (oh, say, /etc/passwd, for instance), and should be for regular users and processes.  But that doesn't mean a process serving unknown and potentially hostile remote users should be able to get a list of accounts to attack on the system.  Which is exactly the risk you should expect whenever you run a service that's designed to read files from a filesystem (like an http or ftp server).<br>
<p>
Chroot isn't the be-all, end-all to this problem, but it's certainly a portable and effective tool that should be used along with others.<br>
<p>
Your comments suggest you've never actually had to support publicaly accessible systems, or understand information security.  It certainly doesn't demonstrate your administrative competence.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253513/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor655081"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 20, 2015 8:24 UTC (Thu)
                               by <b>Wupme</b> (guest, #104124)
                              [<a href="/Articles/655081/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
Sorry but the only thing idiotic is your comment.<br>
<p>
Because THIS<br>
<p>
"should be able to get a list of accounts to attack on the system"<br>
<p>
is security by obscurity. Which is worthless, just like changing SSH from Port 22 to lets say 1234246 or whatever.<br>
<p>
"our comments suggest you've never actually had to support publicaly accessible systems, or understand information security."<br>
<p>
No the one who doesn't understand even basic security is you.<br>
<p>
"It certainly doesn't demonstrate your administrative competence."<br>
<p>
Which is way higher than yours will ever be.<br>
<p>
chroot doesn't add any security, and it was never designed for this anyway.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/655081/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor655100"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Aug 20, 2015 15:28 UTC (Thu)
                               by <b>raven667</b> (subscriber, #5198)
                              [<a href="/Articles/655100/">Link</a>] 
      </p>
      
      </div>
      </summary>
      <div class="FormattedComment">
<font class="QuotedText">&gt; If the daemon itself is insecure, you should simply not have it on your system, chroot or not.</font><br>
<p>
LOL, WUT?<br>
<p>
Are you saying that you only run perfect software that never has security relevant bugs on your systems, where do you find this perfect software and can I get some?  If, like many of us, you run software which is imperfect then limiting its access to system resources when it gets exploited is useful to contain the damage, turning one problem of how to derail the software and take execution control of it, into several including how to escape the container if you want access to data other than what the application normally processes.<br>
<p>
chroot() is a limited way to handle this, the first version of containers, there are better ways to do this now with VMs and Namespaces and SELinux and seccomp and Capsicum, etc. etc. which can make software, not impervious, but more resilient to complete security failure.<br>
</div>

      
          <div class="CommentReplyButton">
            <form action="/Articles/655100/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
</details>
<a name="CommAnchor253327"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 5, 2007 12:49 UTC (Fri)
                               by <b>BenHutchings</b> (subscriber, #37955)
                              [<a href="/Articles/253327/">Link</a>] (1 responses)
      </p>
      
      </div>
      </summary>
      chroot() isn't specified by POSIX, so changing its behaviour wouldn't break the standard (though it might break some applications).<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253327/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    <a name="CommAnchor253341"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">What chroot() is really for</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 5, 2007 14:04 UTC (Fri)
                               by <b>nix</b> (subscriber, #2304)
                              [<a href="/Articles/253341/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Older POSIXes did specify it, and of course it's a user-visible syscall so the usual strict compatibility guarantees apply.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/253341/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</details>
<a name="CommAnchor254078"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">chroot jail</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 12, 2007 1:06 UTC (Fri)
                               by <b>dpotapov</b> (guest, #46495)
                              [<a href="/Articles/254078/">Link</a>] 
      </p>
      
      </div>
      </summary>
      I believe that the term "chroot jail" is essentially correct as it does not allow non-root processes to escape it, but people who believe they can keep omnipotent root in "chroot jail" know nothing about *nix.<br>
<p>
So, usefulness of "chroot jail" from the security point of view is to run applications like Apache in the environment where there is no suid programs, which may have vulnerabilities leading to gaining the root access.<br>
<p>
If you have to have some suid programs in the chroot environment, you can use SELinux's capacities to limited what they can do, so dramatically decrease possibility that a newly found bug can be used to gain the root access.<br>
      
          <div class="CommentReplyButton">
            <form action="/Articles/254078/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
<a name="CommAnchor254207"></a>
    <details class="CommentBox" open>
      <summary><h3 class="CommentTitle">Chroot is useful for security purposes</h3>
      <div class="AnnLine">
      <p class="CommentPoster"> Posted Oct 12, 2007 19:04 UTC (Fri)
                               by <b>pm101</b> (guest, #3011)
                              [<a href="/Articles/254207/">Link</a>] 
      </p>
      
      </div>
      </summary>
      Chroot can mitigate a large number of security vulnerabilities. Recently, adobe.com was cracked when someone found that URLs to the effect of:
<p>
http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=../../../../../../../../..//etc/passwd%00
<p>
would return arbitrary files on the filesystem. This basic exploit allowed reading basic files because a CGI script forgot to sanitize inputs used as filenames. If Adobe has used a chroot jail, this would have been bad, but couldn't be escalated to provide access to execute programs. It wouldn't have even allowed people to view files in users' home directories or unrelated places. 
<p>
Because of the lack of chroot jail, it could be escalated to getting the password file, which could then presumably be combined with a dictionary attack to get a few passwords, and log into the machine. 
<p>
Any security tool misused, including chroot, can cause more problems than it solves. chroot is not a sandbox for running hostile code, and should not be used as such. That said, chroot is a valuable part of a good security toolbox. It is useful for running legacy software with legacy libraries as well, fixing broken installs (I often boot from a CD, and chroot to the hard drive), and other things, but I use it first and foremost as a (somewhat limited) security tool to prevent a limited set of exploits from escalating. 
      
          <div class="CommentReplyButton">
            <form action="/Articles/254207/comment" method="post">
            <input type="submit" value="Reply to this comment">
            </form>
          </div>
        
     <p>
     
    </details>
</div> <!-- middlecolumn -->
<div class="rightcol not-print">
<div id="azk93271_right_zone"></div>
</div>
</div> <!-- maincolumn -->

            <br clear="all">
            <center>
            <P>
            <span class="ReallySmall">
            Copyright &copy; 2007, Eklektix, Inc.<BR>
            This article may be redistributed under the terms of the
              <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
              Commons CC BY-SA 4.0</a> license<br>
            Comments and public postings are copyrighted by their creators.<br>
            Linux  is a registered trademark of Linus Torvalds<br>
            </span>
            </center>
            
            </body></html>
