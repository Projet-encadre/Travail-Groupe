<html><body><table border='1'>
<tr><th>Left Context</th><th>Target Word</th><th>Right Context</th></tr>
<tr><td>[17]Subscribe / [18]Log in / [19]New account</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>By Jake Edge</td><td>root</td><td></td></tr>
<tr><td>October 3, 2007</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>The ch</td><td>root</td><td>() system call is often misunderstood, as it can appear to do</td></tr>
<tr><td>much more than it actually does. The confusion arises because it</td><td>root</td><td></td></tr>
<tr><td>appears to some to be a security tool - there are limited security uses</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>debugging, and legacy library usage.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() actually does is fairly simple, it modifies pathname</td></tr>
<tr><td>lookups for a process and its children so that any reference to a path</td><td>root</td><td></td></tr>
<tr><td>starting '/' will effectively have the new </td><td>root</td><td>, which is passed as the</td></tr>
<tr><td>single argument, prepended onto the path. The current working directory</td><td>root</td><td></td></tr>
<tr><td>is left unchanged and relative paths can still refer to files outside</td><td>root</td><td></td></tr>
<tr><td>of the new </td><td>root</td><td>.</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Calls to ch</td><td>root</td><td>() do not stack, with additional calls essentially</td></tr>
<tr><td>overwriting the existing one. It can only be called by privileged</td><td>root</td><td></td></tr>
<tr><td>programs and can be trivially bypassed by those who can call it as man</td><td>root</td><td></td></tr>
<tr><td>2 ch</td><td>root</td><td> describes:</td></tr>
<tr><td>This  call does not change the current working directory, so that after</td><td>root</td><td></td></tr>
<tr><td>the call '.' can be outside the tree </td><td>root</td><td>ed at '/'.  In particular, the</td></tr>
<tr><td>superuser  can  escape from a 'ch</td><td>root</td><td> jail' by doing 'mkdir foo; ch</td></tr>
<tr><td>foo; cd ..'.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>The use of the term "ch</td><td>root</td><td> jail" in the manpage is unfortunate as it</td></tr>
<tr><td>may help perpetuate a common misconception about ch</td><td>root</td><td>(). It often</td></tr>
<tr><td>gets mentioned in the same context as the "jail" calls for the BSDs,</td><td>root</td><td></td></tr>
<tr><td>but it has little in common with them. A BSD jail is a</td><td>root</td><td></td></tr>
<tr><td>mini-virtualization that partitions a system into multiple virtual</td><td>root</td><td></td></tr>
<tr><td>systems each of which can have its own </td><td>root</td><td> account. ch</td></tr>
<tr><td>of that sophistication.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>A [20]patch posted to the linux-kernel mailing list was aimed at fixing</td><td>root</td><td></td></tr>
<tr><td>the "hole" described in the manpage, but led, instead, to a rather</td><td>root</td><td></td></tr>
<tr><td>contentious thread. The patch changes ch</td><td>root</td><td>() by setting the current</td></tr>
<tr><td>working directory to the new </td><td>root</td><td> if it was not already somewhere</td></tr>
<tr><td>underneath it. This violates POSIX and other standards, which specify</td><td>root</td><td></td></tr>
<tr><td>the current behavior, as well as numerous typical use cases for</td><td>root</td><td></td></tr>
<tr><td>ch</td><td>root</td><td>(). In addition, as was forcefully pointed out in the thread,</td></tr>
<tr><td>there are innumerable ways for a privileged process to access files</td><td>root</td><td></td></tr>
<tr><td>that are not underneath the new </td><td>root</td><td>. Even if it did not run afoul of</td></tr>
<tr><td>the standards, there is no point in fixing something that is so</td><td>root</td><td></td></tr>
<tr><td>trivially bypassed in other ways.</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>The proponents of fixing the problem that they see - even if most of</td><td>root</td><td></td></tr>
<tr><td>the kernel hackers disagree - seem to believe that, while you can</td><td>root</td><td></td></tr>
<tr><td>circumvent a ch</td><td>root</td><td>() call, it should not be possible by using ch</td></tr>
<tr><td>itself. It is an argument that didn't seem to get anywhere for a pretty</td><td>root</td><td></td></tr>
<tr><td>simple reason: ch</td><td>root</td><td>() is not meant to be a security-oriented access</td></tr>
<tr><td>control mechanism. It is, instead, a way to run processes with a</td><td>root</td><td></td></tr>
<tr><td>partitioned view of the filesystem.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>There are reasonable uses of ch</td><td>root</td><td>() for very limited security</td></tr>
<tr><td>purposes. Daemons that do not run as </td><td>root</td><td> can be placed into their own</td></tr>
<tr><td>filesystem subtree - bind/named and Apache are sometimes run this way -</td><td>root</td><td></td></tr>
<tr><td>to prevent any access outside of it. That will work, even if the daemon</td><td>root</td><td></td></tr>
<tr><td>gets exploited, as long as there is no way to elevate privileges after</td><td>root</td><td></td></tr>
<tr><td>the exploit. For example, if there are vulnerable setuid() programs</td><td>root</td><td></td></tr>
<tr><td>accessible from within the ch</td><td>root</td><td>(), full filesystem access is</td></tr>
<tr><td>possible.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>ch</td><td>root</td><td>() is a useful call, many install programs use it, as do programs</td></tr>
<tr><td>that need to see a consistent set of older libraries, but it has very</td><td>root</td><td></td></tr>
<tr><td>limited use in security applications. It does not provide a sandbox</td><td>root</td><td></td></tr>
<tr><td>that can be used to test suspicious code, that code might escalate its</td><td>root</td><td></td></tr>
<tr><td>privilege and access anything it wished. Maintaining an up-to-date</td><td>root</td><td></td></tr>
<tr><td>ch</td><td>root</td><td>() environment adds an additional burden on administrators as</td></tr>
<tr><td>well; update tools do nothing to help keep utilities secure if they</td><td>root</td><td></td></tr>
<tr><td>live outside of the normal places. It is probably safest to avoid using</td><td>root</td><td></td></tr>
<tr><td>it as any kind of security tool.</td><td>root</td><td></td></tr>
<tr><td>Index entries for this article</td><td>root</td><td></td></tr>
<tr><td>[21]Security [22]ch</td><td>root</td><td>()</td></tr>
<tr><td>[23]Security [24]Jails</td><td>root</td><td></td></tr>
<tr><td>__________________________________________</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Log in to post comments</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 4, 2007 4:29 UTC (Thu) by sweikart (guest, #4276) [[25]Link]</td><td>root</td><td></td></tr>
<tr><td>A good overview of using ch</td><td>root</td><td> for security can be found at:</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>[26]http://kerneltrap.org/Linux/Abusing_ch</td><td>root</td><td>#comment-273655</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>> Maintaining an up-to-date ch</td><td>root</td><td>() environment adds an additional</td></tr>
<tr><td>> burden on administrators as well; update tools do nothing to help</td><td>root</td><td></td></tr>
<tr><td>> keep utilities secure if they live outside of the normal places.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Various people have written scripts that will create ch</td><td>root</td><td> jails;</td></tr>
<tr><td>I'm not sure sure how many of them will also update ch</td><td>root</td><td> jails.</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>When you write a ch</td><td>root</td><td>-jail builder-script, it's not that hard to</td></tr>
<tr><td>write it to either create a new jail or update an existing jail</td><td>root</td><td></td></tr>
<tr><td>(I've written my scripts that way).</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 4, 2007 10:29 UTC (Thu) by pointwood (guest, #2814)</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 4, 2007 11:18 UTC (Thu) by petebull (guest, #7857)</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 4, 2007 19:17 UTC (Thu) by sbergman27 (guest, #10767)</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 4, 2007 23:07 UTC (Thu) by smoogen (subscriber, #97)</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 5, 2007 4:04 UTC (Fri) by wahern (subscriber, #37304)</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Lost in this whole debate is something called portability. As a</td><td>root</td><td></td></tr>
<tr><td>developer, I'm not going to write software with the expectation that</td><td>root</td><td></td></tr>
<tr><td>the user will run it in UML or a BSD jail. Fact is, ch</td><td>root</td><td> is available</td></tr>
<tr><td>on every single Unix system, with identical semantics. I'll write my</td><td>root</td><td></td></tr>
<tr><td>software as best I can so that diligent users can run software in a</td><td>root</td><td></td></tr>
<tr><td>jail, but just because others can or would isn't reason to persuade me</td><td>root</td><td></td></tr>
<tr><td>not to use ch</td><td>root</td><td>.</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 5, 2007 12:38 UTC (Fri) by addw (guest, #1771) [[33]Link]</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 5, 2007 15:46 UTC (Fri) by jond (subscriber, #37669)</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 5, 2007 20:29 UTC (Fri) by wahern (subscriber, #37304)</td><td>root</td><td></td></tr>
<tr><td>[[35]Link] (2 responses)</td><td>root</td><td></td></tr>
<tr><td>That ch</td><td>root</td><td> doesn't work? I can also point you to many advisories that</td></tr>
<tr><td>have shown that ch</td><td>root</td><td> also contained an exploit. OpenSSH, BIND, Apache</td></tr>
<tr><td>(OpenBSD), OpenNTP, djbdns, and qmail all use ch</td><td>root</td><td>, and the use of</td></tr>
<tr><td>ch</td><td>root</td><td> has mitigated the impact of serious and widespread code</td></tr>
<tr><td>exploits.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>ch</td><td>root</td><td> is not _the_ answer. In all this debate, either here or on LKML,</td></tr>
<tr><td>I have yet to see anybody mistakingly suggest that ch</td><td>root</td><td> _alone_ is a</td></tr>
<tr><td>sufficient measure. All of these straw men arguments that say that</td><td>root</td><td></td></tr>
<tr><td>ch</td><td>root</td><td> shouldn't be used because ch</td></tr>
<tr><td>fallacious.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>I'm only sticking to my guns because these forums are archived, and I</td><td>root</td><td></td></tr>
<tr><td>don't want to see a student or junior engineer come to me in 10 years</td><td>root</td><td></td></tr>
<tr><td>and say they didn't use ch</td><td>root</td><td>, though they trivially could have,</td></tr>
<tr><td>because they were told it was useless.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 6, 2007 1:40 UTC (Sat) by wahern (subscriber, #37304)</td><td>root</td><td></td></tr>
<tr><td>[[36]Link]</td><td>root</td><td></td></tr>
<tr><td>Oops. By "contained an exploit" I meant that an exploit was limited or</td><td>root</td><td></td></tr>
<tr><td>curtailed, not that the ch</td><td>root</td><td> use itself was related to an exploit.</td></tr>
<tr><td>(Though, like any interface, ch</td><td>root</td><td> could feasibly be part of an attack</td></tr>
<tr><td>vector. As described in this thread, use of ch</td><td>root</td><td> is questionable when</td></tr>
<tr><td>an administrator has to duplicate sensitive files for a ch</td><td>root</td><td>'d</td></tr>
<tr><td>environment.)</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 11, 2007 7:12 UTC (Thu) by gat3way (guest, #47864)</td><td>root</td><td></td></tr>
<tr><td>[[37]Link]</td><td>root</td><td></td></tr>
<tr><td>Nope, ch</td><td>root</td><td>() works and this is its expected behavior.</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>And BTW there are quite a lot of ways to escape it as long as you're</td><td>root</td><td></td></tr>
<tr><td>already a </td><td>root</td><td>. You can for example mount filesystems on some</td></tr>
<tr><td>occasions.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Who said ch</td><td>root</td><td>() must provide security...against someone that already</td></tr>
<tr><td>has </td><td>root</td><td> privilleges on that system???</td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 4, 2007 15:09 UTC (Thu) by ebiederm (subscriber, #35028)</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Look at the mount namespace in the kernel.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>That can give the same effect as ch</td><td>root</td><td> but without being able to</td></tr>
<tr><td>escape.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>itself</td><td>root</td><td></td></tr>
<tr><td>the ongoing work on namespaces can help. Ultimately though while the</td><td>root</td><td></td></tr>
<tr><td>namespaces can help improve security just like ch</td><td>root</td><td> that isn't their</td></tr>
<tr><td>primary point.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 4, 2007 22:18 UTC (Thu) by dowdle (subscriber, #659)</td><td>root</td><td></td></tr>
<tr><td>[[39]Link] (1 responses)</td><td>root</td><td></td></tr>
<tr><td>The article mentions FreeBSD jails and how their ch</td><td>root</td><td> jail is a</td></tr>
<tr><td>mini-virtualization.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>of those require a modified kernel... but they do work well, are</td><td>root</td><td></td></tr>
<tr><td>mature, and offer additional features like resource management,</td><td>root</td><td></td></tr>
<tr><td>separate </td><td>root</td><td> user and accounts, and in the case of OpenVZ,</td></tr>
<tr><td>checkpointing (offline and online/live migration).</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 5, 2007 3:34 UTC (Fri) by jordanb (guest, #45668) [[40]Link]</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 4, 2007 17:12 UTC (Thu) by wahern (subscriber, #37304)</td><td>root</td><td></td></tr>
<tr><td>[[41]Link] (10 responses)</td><td>root</td><td></td></tr>
<tr><td>The advice to not use ch</td><td>root</td><td>() for "security" is just plain wrong.</td></tr>
<tr><td>"Security" involves innumerable facets of programming. To say that</td><td>root</td><td></td></tr>
<tr><td>because something doesn't address all of them simultaneously, and thus</td><td>root</td><td></td></tr>
<tr><td>shouldn't be used at all, is... I can't even begin to describe how</td><td>root</td><td></td></tr>
<tr><td>wrong that advice is. The proper way to use ch</td><td>root</td><td>() in a</td></tr>
<tr><td>security-conscious application is:</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>ch</td><td>root</td><td>()</td></tr>
<tr><td>chdir()</td><td>root</td><td></td></tr>
<tr><td>setuid()</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>One of the best rules of thumb in writing secure software is</td><td>root</td><td></td></tr>
<tr><td>minimization: minimize the resources used; minimize the resources</td><td>root</td><td></td></tr>
<tr><td>available; minimize privilege; minimize, minimize, minimize. ch</td><td>root</td><td>()</td></tr>
<tr><td>fits perfectly into that paradigm.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>When people starting thinking that its better to run a daemon inside</td><td>root</td><td></td></tr>
<tr><td>VMWare because somebody suggests ch</td><td>root</td><td>() is useless shows just how</td></tr>
<tr><td>misleading that advice was (and running VMWare isn't exactly</td><td>root</td><td></td></tr>
<tr><td>minimization, either, when you consider you're adding millions of lines</td><td>root</td><td></td></tr>
<tr><td>of code to your software stack). Just because unplugging your computer</td><td>root</td><td></td></tr>
<tr><td>from the network is "more secure" than having an internet connection</td><td>root</td><td></td></tr>
<tr><td>doesn't mean its either practical or even advisable. ch</td><td>root</td><td>() is</td></tr>
<tr><td>practical and useful for enhancing the security profile of a Unix</td><td>root</td><td></td></tr>
<tr><td>application, period.</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 4, 2007 21:09 UTC (Thu) by ckelso (guest, #43128) [[42]Link]</td><td>root</td><td></td></tr>
<tr><td>(9 responses)</td><td>root</td><td></td></tr>
<tr><td>The only valid argument for using ch</td><td>root</td><td> is that you are ignorant or</td></tr>
<tr><td>distrusting of your filesystem, user and group permissions. ch</td><td>root</td><td></td></tr>
<tr><td>isn't adding anything to the security of the daemon. Having a daemon</td><td>root</td><td></td></tr>
<tr><td>running with a low access system account, what is the difference</td><td>root</td><td></td></tr>
<tr><td>between having it in a ch</td><td>root</td><td> and not having it there? That's simple,</td></tr>
<tr><td>access to things on the system that aren't known secure. It doesn't</td><td>root</td><td></td></tr>
<tr><td>enhance your applications security at all. It mitigates your</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>I don't disagree with the rule of least access. I just don't agree that</td><td>root</td><td></td></tr>
<tr><td>ch</td><td>root</td><td> is enhancing the security of the daemon. If the daemon itself is</td></tr>
<tr><td>insecure, you should simply not have it on your system, ch</td><td>root</td><td> or not.</td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 4, 2007 21:46 UTC (Thu) by wahern (subscriber, #37304)</td><td>root</td><td></td></tr>
<tr><td>[[43]Link]</td><td>root</td><td></td></tr>
<tr><td>That's not a valid argument at all. Why? Because the PROGRAMMER makes</td><td>root</td><td></td></tr>
<tr><td>the decision to use ch</td><td>root</td><td>, not the rest of the world. The real</td></tr>
<tr><td>argument is, do you trust the diligence of the many thousands or</td><td>root</td><td></td></tr>
<tr><td>MILLIONS of ADMINISTRATORS as a whole, not just the best ones; and do</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>(like, maybe they just don't have the time to modify all the stupid</td><td>root</td><td></td></tr>
<tr><td>SUID applications on a modern Linux installation), and if you are the</td><td>root</td><td></td></tr>
<tr><td>least bit humble, then ch</td><td>root</td><td>()+chdir()+setuid()--if it fits the design</td></tr>
<tr><td>and purpose of the application--is a valuable tool.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>aggregate, improve the robustness of the application substantively.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>The problem is that people believe that using ch</td><td>root</td><td> is a hack. Its not</td></tr>
<tr><td>a hack. By that measure, not running daemons as </td><td>root</td><td> is just as much a</td></tr>
<tr><td>hack, because if its "insecure, you should simply not have it on your</td><td>root</td><td></td></tr>
<tr><td>system". Using ch</td><td>root</td><td> is, on its own merits, a useful interface to</td></tr>
<tr><td>marginally increase the robustness of your application. That's as much</td><td>root</td><td></td></tr>
<tr><td>as you can say about anything when writing software, and its all the</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Also, this notion that you need to maintain a whole separate file</td><td>root</td><td></td></tr>
<tr><td>system for ch</td><td>root</td><td>'d applications is nonsense. I've written dozens of</td></tr>
<tr><td>daemons which can ch</td><td>root</td><td> into empty directories. Sure ch</td></tr>
<tr><td>is a PITA if you're using Perl modules. In those cases clearly ch</td><td>root</td><td></td></tr>
<tr><td>conflicts with the functionality of the application. There are lots of</td><td>root</td><td></td></tr>
<tr><td>these cases where file system resources, and process permissions create</td><td>root</td><td></td></tr>
<tr><td>headaches. Many people--and companies--stubbornly run applications as</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td> because its more convenient. Cases of idiots and cases where doing</td></tr>
<tr><td>something is justifiable are not arguments for throwing away a</td><td>root</td><td></td></tr>
<tr><td>technique completely.</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 5, 2007 11:56 UTC (Fri) by Klavs (guest, #10563) [[44]Link]</td><td>root</td><td></td></tr>
<tr><td>(4 responses)</td><td>root</td><td></td></tr>
<tr><td>Ch</td><td>root</td><td> definetely has it's uses in the security field.</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>The apache example is a good one. One should always have several layers</td><td>root</td><td></td></tr>
<tr><td>of security, and putting apache in a ch</td><td>root</td><td> is such a layer - and a</td></tr>
<tr><td>good one at that. The "risk" of someone finding a bug in some website</td><td>root</td><td></td></tr>
<tr><td>software is VERY high - even if it's your own software and you've been</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Also - it is a VERY good idea to mount /tmp none-executable (if in a</td><td>root</td><td></td></tr>
<tr><td>ch</td><td>root</td><td> - there's a limit to what the executable can do though :) and to</td></tr>
<tr><td>have a seperate DB-user for the user (ie. what the casual</td><td>root</td><td></td></tr>
<tr><td>browser/internet user sees) and the admin section, and remember the</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 5, 2007 15:47 UTC (Fri) by jond (subscriber, #37669)</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 5, 2007 22:04 UTC (Fri) by giraffedata (guest, #1954)</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Then you'd probably want to make sure that loader isn't present in your</td><td>root</td><td></td></tr>
<tr><td>ch</td><td>root</td><td> jail. I assume you're talking about glibc's ld-linux.so, which</td></tr>
<tr><td>is an essential part of running programs that use dynamically linked</td><td>root</td><td></td></tr>
<tr><td>libraries. Ch</td><td>root</td><td> jails I've seen have statically linked programs and</td></tr>
<tr><td>don't need it.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Incidentally, if this is really an issue -- people want to have shared</td><td>root</td><td></td></tr>
<tr><td>libraries within a ch</td><td>root</td><td> jail and still stop people from running</td></tr>
<tr><td>programs they created themselves in /tmp -- it would not be hard to</td><td>root</td><td></td></tr>
<tr><td>disable ld-linux.so's ability to run programs like that. The ability to</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 11, 2007 8:48 UTC (Thu) by tbleher (guest, #48307)</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 7, 2007 17:56 UTC (Sun) by thedevil (guest, #32913)</td><td>root</td><td></td></tr>
<tr><td>[[48]Link]</td><td>root</td><td></td></tr>
<tr><td>>> The apache example is a good one. One should always have several</td><td>root</td><td></td></tr>
<tr><td>layers of security, and putting apache in a ch</td><td>root</td><td> is such a layer -</td></tr>
<tr><td>and a good one at that. The "risk" of someone finding a bug in some</td><td>root</td><td></td></tr>
<tr><td>website software is VERY high - even if it's your own software and</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>How do you enable per-user web directories (typically ~/public_html) if</td><td>root</td><td></td></tr>
<tr><td>the webserver is ch</td><td>root</td><td>ed?</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 6, 2007 23:22 UTC (Sat) by acorliss (guest, #3710)</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>designed to read files from a filesystem (like an http or ftp server).</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Ch</td><td>root</td><td> isn't the be-all, end-all to this problem, but it's certainly a</td></tr>
<tr><td>portable and effective tool that should be used along with others.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Aug 20, 2015 8:24 UTC (Thu) by Wupme (guest, #104124) [[50]Link]</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Which is way higher than yours will ever be.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>ch</td><td>root</td><td> doesn't add any security, and it was never designed for this</td></tr>
<tr><td>anyway.</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Aug 20, 2015 15:28 UTC (Thu) by raven667 (subscriber, #5198)</td><td>root</td><td></td></tr>
<tr><td>[[51]Link]</td><td>root</td><td></td></tr>
<tr><td>> If the daemon itself is insecure, you should simply not have it on</td><td>root</td><td></td></tr>
<tr><td>your system, ch</td><td>root</td><td> or not.</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>LOL, WUT?</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>data other than what the application normally processes.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>ch</td><td>root</td><td>() is a limited way to handle this, the first version of</td></tr>
<tr><td>containers, there are better ways to do this now with VMs and</td><td>root</td><td></td></tr>
<tr><td>Namespaces and SELinux and seccomp and Capsicum, etc. etc. which can</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 5, 2007 12:49 UTC (Fri) by BenHutchings (subscriber, #37955)</td><td>root</td><td></td></tr>
<tr><td>[[52]Link] (1 responses)</td><td>root</td><td></td></tr>
<tr><td>ch</td><td>root</td><td>() isn't specified by POSIX, so changing its behaviour wouldn't</td></tr>
<tr><td>break the standard (though it might break some applications).</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>What ch</td><td>root</td><td>() is really for</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 5, 2007 14:04 UTC (Fri) by nix (subscriber, #2304)</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>ch</td><td>root</td><td> jail</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 12, 2007 1:06 UTC (Fri) by dpotapov (guest, #46495)</td><td>root</td><td></td></tr>
<tr><td>[[54]Link]</td><td>root</td><td></td></tr>
<tr><td>I believe that the term "ch</td><td>root</td><td> jail" is essentially correct as it does</td></tr>
<tr><td>not allow non-</td><td>root</td><td> processes to escape it, but people who believe they</td></tr>
<tr><td>can keep omnipotent </td><td>root</td><td> in "ch</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>So, usefulness of "ch</td><td>root</td><td> jail" from the security point of view is to</td></tr>
<tr><td>run applications like Apache in the environment where there is no suid</td><td>root</td><td></td></tr>
<tr><td>programs, which may have vulnerabilities leading to gaining the </td><td>root</td><td></td></tr>
<tr><td>access.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>If you have to have some suid programs in the ch</td><td>root</td><td> environment, you</td></tr>
<tr><td>can use SELinux's capacities to limited what they can do, so</td><td>root</td><td></td></tr>
<tr><td>dramatically decrease possibility that a newly found bug can be used to</td><td>root</td><td></td></tr>
<tr><td>gain the </td><td>root</td><td> access.</td></tr>
<tr><td>Reply to this comment</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Ch</td><td>root</td><td> is useful for security purposes</td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Posted Oct 12, 2007 19:04 UTC (Fri) by pm101 (guest, #3011) [[55]Link]</td><td>root</td><td></td></tr>
<tr><td>Ch</td><td>root</td><td> can mitigate a large number of security vulnerabilities.</td></tr>
<tr><td>Recently, adobe.com was cracked when someone found that URLs to the</td><td>root</td><td></td></tr>
<tr><td>effect of:</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>would return arbitrary files on the filesystem. This basic exploit</td><td>root</td><td></td></tr>
<tr><td>allowed reading basic files because a CGI script forgot to sanitize</td><td>root</td><td></td></tr>
<tr><td>inputs used as filenames. If Adobe has used a ch</td><td>root</td><td> jail, this would</td></tr>
<tr><td>have been bad, but couldn't be escalated to provide access to execute</td><td>root</td><td></td></tr>
<tr><td>programs. It wouldn't have even allowed people to view files in users'</td><td>root</td><td></td></tr>
<tr><td>home directories or unrelated places.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Because of the lack of ch</td><td>root</td><td> jail, it could be escalated to getting</td></tr>
<tr><td>the password file, which could then presumably be combined with a</td><td>root</td><td></td></tr>
<tr><td>dictionary attack to get a few passwords, and log into the machine.</td><td>root</td><td></td></tr>
<tr><td></td><td>root</td><td></td></tr>
<tr><td>Any security tool misused, including ch</td><td>root</td><td>, can cause more problems</td></tr>
<tr><td>than it solves. ch</td><td>root</td><td> is not a sandbox for running hostile code, and</td></tr>
<tr><td>should not be used as such. That said, ch</td><td>root</td><td> is a valuable part of a</td></tr>
<tr><td>good security toolbox. It is useful for running legacy software with</td><td>root</td><td></td></tr>
<tr><td>legacy libraries as well, fixing broken installs (I often boot from a</td><td>root</td><td></td></tr>
<tr><td>CD, and ch</td><td>root</td><td> to the hard drive), and other things, but I use it first</td></tr>
<tr><td>and foremost as a (somewhat limited) security tool to prevent a limited</td><td>root</td><td></td></tr>
<tr><td>set of exploits from escalating.</td><td>root</td><td></td></tr>
<tr><td>--</td><td>root</td><td></td></tr>
<tr><td>20. file:///Articles/252806/</td><td>root</td><td></td></tr>
<tr><td>21. file:///Security/Index/</td><td>root</td><td></td></tr>
<tr><td>22. file:///Security/Index/#ch</td><td>root</td><td></td></tr>
<tr><td>23. file:///Security/Index/</td><td>root</td><td></td></tr>
<tr><td>24. file:///Security/Index/#Jails</td><td>root</td><td></td></tr>
<tr><td>25. file:///Articles/253007/</td><td>root</td><td></td></tr>
<tr><td>26. http://kerneltrap.org/Linux/Abusing_ch</td><td>root</td><td>#comment-273655</td></tr>
<tr><td>27. file:///Articles/253062/</td><td>root</td><td></td></tr>
<tr><td>28. file:///Articles/253071/</td><td>root</td><td></td></tr>
</table></body></html>
